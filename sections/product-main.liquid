{% comment %}theme-check-disable UndefinedObject{% endcomment %}
<link rel="stylesheet" href="{{ 'component-deferred-media.css' | asset_url }}" media="print" onload="this.media='all'">
{% include "colors-snippet" %}
{% assign type = section.settings.product_section_type %}
{% case type %}
  {%- when "default" -%} 
    {% render 'product-default' %}
{%- when "variants" -%}
    {% render 'product-with-variants', colorScheme:colorScheme %}
{% endcase %}

{% schema %}
{
    "name": "Product template",
    "settings": [
        {
            "type": "select",
            "id": "product_section_type",
            "label": "Select product type",
            "options": [
              {
                "value": "default",
                "label": "Default"
              },
              {
                "value": "variants",
                "label": "Product with variants"
              }
            ],
            "default": "default" 
          }
          
    ],
    "blocks": [
      {
        "type": "quantity_selector",
        "name": "Quantity selector",
        "limit": 1
      }
    ],
    "presets": [
        {
            "name": "Product template",
            "category": "ADVANCED LAYOUT"
        }
    ]
}
{% endschema %} 
{% javascript %}
  class ProductModal extends ModalDialog {
    constructor() {
      super();
    }

    hide() {
      super.hide();
      window.pauseAllMedia();
    }

    show(opener) {
      super.show(opener);
      this.showActiveMedia();
    }

    showActiveMedia() {
      this.querySelectorAll(`[data-media-id]:not([data-media-id="${this.openedBy.getAttribute("data-media-id")}"])`).forEach((element) => {
          element.classList.remove('active');
        }
      )
      const activeMedia = this.querySelector(`[data-media-id="${this.openedBy.getAttribute("data-media-id")}"]`);
      activeMedia.classList.add('active');
      activeMedia.scrollIntoView();

      if (activeMedia.nodeName == 'DEFERRED-MEDIA' && activeMedia.querySelector('template')?.content?.querySelector('.js-youtube'))
        activeMedia.loadContent();
    }
  }

  customElements.define('product-modal', ProductModal);
{% endjavascript %}