{% comment %}theme-check-disable UndefinedObject{% endcomment %}
<link rel="stylesheet" href="{{ 'component-deferred-media.css' | asset_url }}" media="print" onload="this.media='all'">
<script src="{{ 'details-disclosure.js' | asset_url }}" defer="defer"></script>
{% include "colors-snippet" %}
{% assign type = section.settings.product_section_type %}
{% case type %}
  {%- when "default" -%} 
    {% render 'product-default' %}
{%- when "variants" -%}
    {% render 'product-with-variants', colorScheme:colorScheme %}
{% endcase %}

{% schema %}
{
    "name": "Product template",
    "settings": [
        {
            "type": "select",
            "id": "product_section_type",
            "label": "Select product type",
            "options": [
              {
                "value": "default",
                "label": "Default"
              },
              {
                "value": "variants",
                "label": "Product with variants"
              }
            ],
            "default": "default" 
          },
          {
            "type": "select",
            "id": "product_main_color_scheme",
            "info" : "choose a background",
            "options": [
              {
                "label": "Accent 1",
                "value": "accent-1"
              },
              {
                "label": "Accent 2",
                "value": "accent-2"
              },
              {
                "label": "Background 1",
                "value": "background-1"
              },
              {
                "label": "Background 2",
                "value": "background-2"
              },
              {
                "label": "Background 3",
                "value": "background-3"
              },
              {
                "label": "Background 4",
                "value": "background-4"
              },
              {
                "label": "Background 5",
                "value": "background-5"
              },
              {
                "label": "Inverse",
                "value": "inverse"
              }
            ],
            "label": "Color Scheme",
            "default": "background-4"
          }
          
    ],
    "blocks": [
      {
        "type": "@app" 
      },
      {
        "type": "quantity_selector",
        "name": "Quantity selector",
        "limit": 1
      },
      {
        "type": "text",
        "name": "text",
        "settings": [
          {
            "type": "text",
            "id": "text",
            "label": "text block"
          },
          {
            "type": "select",
            "id": "text_style",
            "options": [
              {
                "value": "body",
                "label": "body"
              },
              {
                "value": "subtitle",
                "label": "subtitle"
              },
              {
                "value": "uppercase",
                "label": "uppercase"
              }
            ],
            "default": "body",
            "label": "Text style"
          }
        ]
      },
      {
        "type": "buy_buttons",
        "name": "Buy button",
        "limit": 1,
        "settings": [
          {
            "type": "checkbox",
            "id": "show_dynamic_checkout",
            "default": true,
            "label": "Show dynamic checkout buttons",
            "info": "Using the payment methods available on your store, customers see their preferred option, like PayPal or Apple Pay"
          }
        ]
      },
      {
        "type": "title",
        "name": "Title",
        "limit": 1
      },
      {
        "type": "price",
        "name": "Price",
        "limit": 1
      },
      {
        "type": "description",
        "name": "Description",
        "limit": 1
      }
    ],
    "presets": [
        {
            "name": "Product template",
            "category": "ADVANCED LAYOUT"
        }
    ]
}
{% endschema %} 
{% javascript %}
  class ProductModal extends ModalDialog {
    constructor() {
      super();
    }

    hide() {
      super.hide();
      window.pauseAllMedia();
    }

    show(opener) {
      super.show(opener);
      this.showActiveMedia();
    }

    showActiveMedia() {
      this.querySelectorAll(`[data-media-id]:not([data-media-id="${this.openedBy.getAttribute("data-media-id")}"])`).forEach((element) => {
          element.classList.remove('active');
        }
      )
      const activeMedia = this.querySelector(`[data-media-id="${this.openedBy.getAttribute("data-media-id")}"]`);
      activeMedia.classList.add('active');
      activeMedia.scrollIntoView();

      if (activeMedia.nodeName == 'DEFERRED-MEDIA' && activeMedia.querySelector('template')?.content?.querySelector('.js-youtube'))
        activeMedia.loadContent();
    }
  }

  customElements.define('product-modal', ProductModal);
{% endjavascript %}